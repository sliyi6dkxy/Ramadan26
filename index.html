<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ù…Ø³Ø§ÙƒÙŠØ© Ø±Ù…Ø¶Ø§Ù†</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Tajawal', sans-serif;
  background:#fbf6e8;
  color:#4b3b2a;
  min-height:100vh;
}

.container{
  max-width:420px;
  margin:0 auto;
  padding:34px 18px 24px;
}

.message{
  text-align:center;
  margin-bottom:26px;
  animation:fadeDown .7s ease forwards;
}

.message .moon{
  font-size:28px;
  margin-bottom:8px;
}

.message h1{
  font-size:23px;
  font-weight:600;
  margin:6px 0;
}

.message p{
  font-size:17px;
  line-height:1.8;
  margin:0;
  opacity:.9;
}

@keyframes fadeDown{
  from{opacity:0; transform:translateY(-10px);}
  to{opacity:1; transform:translateY(0);}
}

.register-box{
  text-align:center;
  margin-top:14px;
}

.register-box .subtitle{
  font-size:16.5px;
  line-height:1.9;
  margin-bottom:18px;
}

.input-group{
  display:flex;
  justify-content:center;
  gap:10px;
}

input{
  flex:1;
  padding:12px 16px;
  font-size:16px;
  border-radius:20px;
  border:1px solid #d6c6a5;
  outline:none;
  font-family:'Tajawal', sans-serif;
}

button{
  padding:12px 18px;
  font-size:16px;
  border-radius:20px;
  border:none;
  background:#7a9b7e;
  color:white;
  cursor:pointer;
  font-family:'Tajawal', sans-serif;
}

button:hover{
  background:#688c6d;
}

.hidden{display:none;}
</style>
</head>

<body>

<div class="container">

  <div id="registerBox">
    <div class="message">
      <div class="moon">ğŸŒ™</div>
      <h1>Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…</h1>
      <p>Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù„ÙŠØµÙ„Ùƒ ÙƒÙ„ Ø¬Ø¯ÙŠØ¯ ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø®Ù„Ø§Ù„ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ</p>
    </div>

    <div class="register-box">
      <div class="subtitle">
        Ù…ØªØ§Ø¨Ø¹Ø© Ø®ÙÙŠÙØ© â€¢ ØªØ°ÙƒÙŠØ± â€¢ Ø£Ø¬Ø± Ø¨Ø¥Ø°Ù† Ø§Ù„Ù„Ù‡
      </div>

      <div class="input-group">
        <input type="text" id="username" placeholder="Ø§Ø³Ù…Ùƒ">
        <button onclick="saveName()">Ù…ØªØ§Ø¨Ø¹Ø©</button>
      </div>
    </div>
  </div>

  <div id="welcomeBox" class="hidden"></div>

</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx3RS-hPuifQMO0Fpkz5iYrausYEDlmMbw8thMg12QxpmAs_BJxLhJ0wN7gU7tBlsKvng/exec";

const NAME_KEY = "ramadan_user_name";
const ID_KEY = "ramadan_user_id";

function generateUserId(){
  return "u_" + Date.now() + "_" + Math.random().toString(36).substring(2,8);
}

function sendToSheet(payload){
  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify(payload),
    headers: {
      "Content-Type": "application/json"
    }
  }).catch(err => console.error(err));
}

function saveName(){
  const name = document.getElementById("username").value.trim();
  if(!name) return;

  let userId = localStorage.getItem(ID_KEY);
  if(!userId){
    userId = generateUserId();
    localStorage.setItem(ID_KEY, userId);
  }

  localStorage.setItem(NAME_KEY, name);

  sendToSheet({
    name: name,
    user_id: userId,
    action: "visit"
  });

  showWelcome(name, true);
}

function showWelcome(name, firstTime){
  document.getElementById("registerBox").classList.add("hidden");
  const box = document.getElementById("welcomeBox");
  box.classList.remove("hidden");

  box.innerHTML = `
    <div class="message">
      <div class="moon">ğŸŒ™</div>
      <h1>Ù…Ø±Ø­Ø¨Ù‹Ø§ ${name}</h1>
      <p>
        ${firstTime 
          ? "Ù†Ø³Ø£Ù„ Ø§Ù„Ù„Ù‡ Ø£Ù† ÙŠØ¨Ø§Ø±Ùƒ Ù„Ùƒ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø± ÙˆÙŠØ¹ÙŠÙ†Ùƒ Ø¹Ù„Ù‰ Ø§ØºØªÙ†Ø§Ù…Ù‡"
          : "Ù†Ø³Ø£Ù„ Ø§Ù„Ù„Ù‡ Ø£Ù† ÙŠÙƒØªØ¨ Ù„Ùƒ Ø§Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…"}
      </p>
    </div>
  `;
}

window.onload = () => {
  const name = localStorage.getItem(NAME_KEY);
  const userId = localStorage.getItem(ID_KEY);

  if(name && userId){
    sendToSheet({
      name: name,
      user_id: userId,
      action: "visit"
    });

    showWelcome(name, false);
  }
};
</script>

</body>
</html>
