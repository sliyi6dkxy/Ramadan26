<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Ù…ÙØ§Ø¬Ø£Ø© Ø§Ù„Ø¹ÙŠØ¯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BME9NXNCFQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BME9NXNCFQ');
  </script>

  <style>
    :root{
      --bg:#1b1a17;
      --card: rgba(255,255,255,0.06);
      --accent: #ffd369;
      --btn:#f7c04a;
    }
    body{
      margin:0;
      padding:0;
      font-family: "Arial", sans-serif;
      background:var(--bg);
      color:#fff;
      text-align:center;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    h2{ font-size:28px; margin-top:10px; }

    /* Ø§Ù„Ø¹Ø¯ */
    .countdown-container{ margin-top:5px; font-size:26px; display:flex; justify-content:center; gap:12px; }

    /* Ø¨Ø§Ù„ÙˆÙ†Ø§Øª */
    #balloons{ position:fixed; top:0; left:0; width:100%; pointer-events:none; z-index:999; display:block; }

    .surprise img{ max-width:90%; height:auto; margin-top:20px; animation: fadeIn 2s ease-in-out; }
    @keyframes fadeIn{ from{opacity:0} to{opacity:1} }

    .duaa-title{ font-size:22px; margin:35px 0 10px; }
    .duaa-carousel{ display:flex; overflow-x:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch; padding:0 2%; gap:5px; justify-content:flex-start;}
    .duaa-carousel img{ flex:0 0 96%; scroll-snap-align:start; max-width:96%; height:auto; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }

    /* Ù…Ø±Ø¨Ø¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */
    #registerBox{
      background:var(--card);
      padding:18px;
      margin:18px auto;
      border-radius:12px;
      width:90%;
      max-width:420px;
      box-sizing:border-box;
      transition: all .35s ease;
    }
    #registerBox p{ margin:6px 0 12px; color:#fff; }
    #registerBox input{
      padding:10px;
      border-radius:8px;
      border:none;
      width:78%;
      text-align:center;
      font-size:16px;
      background:rgba(255,255,255,0.04);
      color:#fff;
    }
    #registerBox button{
      margin-top:10px;
      padding:10px 16px;
      background:var(--btn);
      color:#000;
      border:none;
      border-radius:8px;
      font-weight:bold;
      cursor:pointer;
    }

    /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ù…Ø¹ fade-in */
    #welcomeMsg{
      font-size:20px;
      margin:16px;
      color:var(--accent);
      opacity:0;
      transform: translateY(8px);
      transition: opacity .45s ease, transform .45s ease;
    }
    #welcomeMsg.show{
      opacity:1;
      transform: translateY(0);
    }

    /* responsive */
    @media (max-width:420px){
      .countdown-container{ font-size:20px; gap:8px; }
      #registerBox input{ width:70%; }
    }
  </style>
</head>
<body>
  <h2 id="title">Ø§Ù„Ù…ÙØ§Ø¬Ø£Ø© ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯:</h2>
  <div id="countdown" class="countdown-container"></div>

  <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (ÙŠØ¸Ù‡Ø± Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ø¥Ù† Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ø§Ø³Ù… Ù…Ø­ÙÙˆØ¸Ø§Ù‹) -->
  <div id="registerBox" aria-live="polite">
    <p>Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:</p>
    <input id="username" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§" aria-label="Ø§Ø³Ù… Ø§Ù„Ø²Ø§Ø¦Ø±">
    <br>
    <button id="confirmBtn">ØªØ£ÙƒÙŠØ¯</button>
  </div>

  <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
  <div id="welcomeMsg" aria-hidden="true" style="display:none;"></div>

  <!-- Ø§Ù„Ù…ÙØ§Ø¬Ø£Ø© -->
  <div id="surprise" class="surprise" style="display:none;">
    <canvas id="balloons"></canvas>
    <h2>Ø¹ÙŠØ¯ÙƒÙ… Ù…Ø¨Ø§Ø±Ùƒ!</h2>
    <img src="https://raw.githubusercontent.com/sliyi6dkxy/Ramadan26/main/Picsart_25-03-25_22-21-41-520.png" alt="ØªÙ‡Ù†Ø¦Ø© Ø§Ù„Ø¹ÙŠØ¯">
  </div>

  <div class="duaa-title">ÙƒÙ„ ÙŠÙˆÙ… Ø¯Ø¹Ø§Ø¡ Ø¬Ø¯ÙŠØ¯</div>
  <div class="duaa-carousel" aria-hidden="false">
    <img src="https://raw.githubusercontent.com/sliyi6dkxy/Ramadan26/main/IMG_20250422_172723_104.jpg" alt="Ø¯Ø¹Ø§Ø¡ 1">
    <img src="https://raw.githubusercontent.com/sliyi6dkxy/Ramadan26/main/IMG_20250422_172723_104.jpg" alt="Ø¯Ø¹Ø§Ø¡ 2">
    <img src="https://raw.githubusercontent.com/sliyi6dkxy/Ramadan26/main/IMG_20250422_172723_104.jpg" alt="Ø¯Ø¹Ø§Ø¡ 3">
  </div>

<script>
/* ===========================
   Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â€” ØºÙŠÙ‘Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§ Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· Web App Ø¥Ù† Ø§Ø®ØªÙ„Ù
   =========================== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxNrd5WcQmQbWRg0P9DgOXHT4ktIUSCZUphsbWZsn-Be6OSTVO3Kg7qazrLXrrOig2oMQ/exec";

/* ======= Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ (ØªÙ†Ø³ÙŠÙ‚ Ø£ÙŠØ§Ù…:Ø³Ø§Ø¹Ø§Øª:Ø¯Ù‚Ø§Ø¦Ù‚:Ø«ÙˆØ§Ù†ÙŠ) ======= */
const targetDate = new Date("2025-04-24T20:45:00").getTime();
const countdownEl = document.getElementById("countdown");
const titleEl = document.getElementById("title");
const surpriseEl = document.getElementById("surprise");

function formatCountdown(diff){
  const days = Math.floor(diff / (1000*60*60*24));
  const hours = Math.floor((diff / (1000*60*60)) % 24);
  const minutes = Math.floor((diff / (1000*60)) % 60);
  const seconds = Math.floor((diff / 1000) % 60);
  return `${String(days).padStart(2,'0')} : ${String(hours).padStart(2,'0')} : ${String(minutes).padStart(2,'0')} : ${String(seconds).padStart(2,'0')}`;
}

function updateCountdown(){
  const now = Date.now();
  const diff = targetDate - now;
  if (diff <= 0){
    countdownEl.style.display = "none";
    titleEl.style.display = "none";
    surpriseEl.style.display = "block";
    showBalloons();
    clearInterval(countdownTimer);
    return;
  }
  countdownEl.textContent = formatCountdown(diff);
}
const countdownTimer = setInterval(updateCountdown, 1000);
updateCountdown();

/* ======= Ø¨Ø§Ù„ÙˆÙ†Ø§Øª (Canvas) â€” ØªØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ø¯ ÙˆØªØ¹Ù…Ù„ 15 Ø«Ø§Ù†ÙŠØ© ======= */
function showBalloons(){
  const canvas = document.getElementById("balloons");
  if (!canvas) return;
  let ctx = null;
  try { ctx = canvas.getContext("2d"); } catch(e){ return; }

  function resize(){
    const dpr = window.devicePixelRatio || 1;
    canvas.width = Math.floor(window.innerWidth * dpr);
    canvas.height = Math.floor(window.innerHeight * dpr);
    canvas.style.width = window.innerWidth + "px";
    canvas.style.height = window.innerHeight + "px";
    if (ctx && ctx.setTransform) ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  resize();
  window.addEventListener("resize", resize);

  const count = Math.min(30, Math.max(8, Math.floor(window.innerWidth / 30)));
  const balloons = [];
  for (let i=0;i<count;i++){
    balloons.push({
      x: Math.random()*window.innerWidth,
      y: window.innerHeight + Math.random()*200,
      r: 6 + Math.random()*10,
      color: `hsl(${Math.random()*360},70%,${50+Math.random()*20}%)`,
      speed: 0.6 + Math.random()*1.6,
      drift: (Math.random()-0.5)*0.6
    });
  }

  let animationId = null;
  const start = performance.now();

  function animate(now){
    const elapsed = now - start;
    if (elapsed >= 15000){
      if (animationId) cancelAnimationFrame(animationId);
      ctx.clearRect(0,0,canvas.width,canvas.height);
      window.removeEventListener("resize", resize);
      return;
    }
    ctx.clearRect(0,0,canvas.width,canvas.height);
    balloons.forEach(b=>{
      ctx.beginPath();
      ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
      ctx.fillStyle = b.color;
      ctx.fill();
      b.x += b.drift;
      b.y -= b.speed;
      if (b.y + b.r < -20) { b.y = window.innerHeight + Math.random()*80; b.x = Math.random()*window.innerWidth; }
      if (b.x < -50) b.x = window.innerWidth + 50;
      if (b.x > window.innerWidth + 50) b.x = -50;
    });
    animationId = requestAnimationFrame(animate);
  }

  animationId = requestAnimationFrame(animate);
}

/* ======= ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ø³Ù… â€” Ø¥Ø¸Ù‡Ø§Ø± ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙˆØ­ÙØ¸Ù‡ Ø¨Ø§Ù„Ù…ØªØµÙØ­ ======= */
const registerBox = document.getElementById("registerBox");
const confirmBtn = document.getElementById("confirmBtn");
const welcomeMsg = document.getElementById("welcomeMsg");
const usernameInput = document.getElementById("username");

function fadeInWelcome(){
  welcomeMsg.style.display = "block";
  // force reflow for transition
  setTimeout(()=> welcomeMsg.classList.add("show"), 30);
}

function showWelcome(name){
  registerBox.style.display = "none";
  welcomeMsg.innerHTML = `Ø£Ù‡Ù„Ù‹Ø§ ÙˆØ³Ù‡Ù„Ù‹Ø§ Ø¨Ùƒ ÙŠØ§ <b>${escapeHtml(name)}</b> ğŸŒ¸<br>Ù†ØªÙ…Ù†Ù‰ Ø£Ù† ØªØ·Ù„Ø¹ Ø¹Ù„Ù‰ ÙƒÙ„ Ø¬Ø¯ÙŠØ¯ ğŸ‰`;
  fadeInWelcome();
}

/* ØªÙˆÙ„ÙŠØ¯ userId ÙˆØ­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ */
function generateUserId(){
  return 'user-' + Math.random().toString(36).substr(2,9);
}

/* Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Apps Script (POST JSON) */
function sendVisitToServer(name, userId){
  // Ù†Ø±Ø³Ù„ POST JSON Ø£ÙØ¶Ù„ Ù…Ù† GET Ù„Ø¹Ø¯Ù… Ø¸Ù‡ÙˆØ± Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ URL
  fetch(SCRIPT_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name: name, userId: userId })
  })
  .then(r => r.text())
  .then(text => console.log("Server response:", text))
  .catch(err => console.warn("Failed to send visit:", err));
}

/* Ø¥Ø¯Ø§Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø³Ù„Ø§Ù…Ø© - Ù‡Ø±ÙˆØ¨ HTML Ø¨Ø³ÙŠØ· */
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, function(m){
    return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
  });
}

/* Ø­Ø¯Ø« Ø§Ù„ØªØ£ÙƒÙŠØ¯ */
confirmBtn.addEventListener("click", ()=>{
  const name = usernameInput.value.trim();
  if (!name){ alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø£ÙˆÙ„Ø§Ù‹ ğŸŒŸ"); usernameInput.focus(); return; }

  let userId = localStorage.getItem("visitorUserId");
  if (!userId){
    userId = generateUserId();
    localStorage.setItem("visitorUserId", userId);
  }
  localStorage.setItem("visitorName", name);

  // Ø¥Ø¸Ù‡Ø§Ø± ØªØ±Ø­ÙŠØ¨
  showWelcome(name);

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ù„Ù„Ø®Ø§Ø¯Ù…
  sendVisitToServer(name, userId);
});

/* Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©: Ø¥Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ localStorage Ø§Ø¹Ø±Ø¶ Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙˆØ£Ø±Ø³Ù„ Ø§Ù„Ø²ÙŠØ§Ø±Ø© */
window.addEventListener("load", ()=>{
  const savedName = localStorage.getItem("visitorName");
  const savedId = localStorage.getItem("visitorUserId");
  if (savedName && savedId){
    showWelcome(savedName);
    // Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø²ÙŠØ§Ø±Ø© (Ø³ØªÙ‚ÙˆÙ… Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨ØªØ­Ø¯ÙŠØ« lastVisit ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª)
    sendVisitToServer(savedName, savedId);
  }
});
</script>
</body>
</html>
